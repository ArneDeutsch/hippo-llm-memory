# Codex Tasks — Mitigations for 20250901_50_1337_2025 Run
_Generated: 2025-09-01 15:17 UTC_

> This plan targets the recurring issues identified in the latest run review.

## T01. Add 'Meaningful Run' preflight gate

**Rationale.** Prevent meaningless runs (missing baselines, stub stores, no gating).

**Implementation steps.**
- Add `preflight_check()` in eval harness: verify baseline pre_* metrics present; store_meta.source != 'stub'; gating attempts > 0 on 1-batch teach dry-run.
- Emit `failed_preflight.json` and stop run with actionable error.
- Render preflight status panel in `reports/index.md`.
**Acceptance criteria.**
- [ ] Run aborts with clear diagnostics if any preflight fails.
- [ ] reports show preflight status badges.
**Files/paths.** scripts/eval_harness.py, reports/templates/index.md.j2

## T02. Compute & persist baseline pre_* metrics with CIs

**Rationale.** Uplift cannot be computed without baselines.

**Implementation steps.**
- Implement baseline-only phase and persist `baselines/metrics.csv` with em_raw/em_norm/f1 + 95% CI.
- Render baseline table and write `baselines_ok.flag`.
**Acceptance criteria.**
- [ ] `baselines/metrics.csv` non-NaN for all suites in scope.
- [ ] Preflight passes when `baselines_ok.flag` exists.
**Files/paths.** scripts/run_baselines.py, reports/render_baselines.py, reports/templates/partials/baselines.md.j2

## T03. Fix EM normalization invariants

**Rationale.** Normalized EM must never contradict raw EM.

**Implementation steps.**
- Define or remove normalization; enforce `em_norm == 0` when `em_raw == 0`.
- Make reports prioritize `em_raw` and include a tooltip for normalization.
- Add unit tests for scorer invariants.
**Acceptance criteria.**
- [ ] No case where em_raw=0 and em_norm>0 remains.
- [ ] Unit tests pass on fixtures.
**Files/paths.** hippo_mem/metrics/scoring.py, tests/test_scoring.py, reports/templates

## T04. Episodic writer: content fields + key diversity

**Rationale.** Ensure the episodic store isn't degenerate.

**Implementation steps.**
- Write `tokens_span`, `entity_slots`, `state_sketch`, `salience_tags`.
- Derive keys from contextual embeddings with noise to avoid collapse.
- Add kNN recall tests for partial cues.
**Acceptance criteria.**
- [ ] ≥80% items have non-empty fields; unique keys ≥ items/2.
- [ ] Recall@5 ≥ 0.7 on synthetic fixtures.
**Files/paths.** hippo_mem/memory/episodic_store.py, tests/test_episodic_store.py

## T05. Semantic suite: enforce KG dependency + ablation

**Rationale.** Avoid saturation without memory.

**Implementation steps.**
- Teach extracts triples and writes to KG; test masks prompts to require KG retrieval.
- Add ablation run with empty KG; assert ΔEM ≥ 0.2.
**Acceptance criteria.**
- [ ] EM with KG ≥ baseline +0.2; with KG ablated drops ≥0.2.
**Files/paths.** hippo_mem/memory/kg_store.py, datasets/semantic/*, scripts/run_semantic.py, tests/test_semantic_dependency.py

## T06. Spatial suite: PlaceGraph + path scorer alignment

**Rationale.** Make spatial suite feasible and memory-using.

**Implementation steps.**
- Implement PlaceGraph writes during teach (edges with cost).
- Use A*/shortest-path planner in test.
- Score feasibility and ≤1.2× optimality; update fixtures.
**Acceptance criteria.**
- [ ] Toy grids: success ≥0.8 with memory; ≤0.3 without.
- [ ] Median suboptimality ≤1.2.
**Files/paths.** hippo_mem/memory/spatial_store.py, hippo_mem/planning/path_planner.py, tests/test_spatial_store.py, tests/test_spatial_planner.py

## T07. Gating telemetry & thresholds

**Rationale.** Gating must attempt writes in teach and be visible.

**Implementation steps.**
- Lower teach thresholds (e.g., tau=0.3) and log attempts/accepts/rejects.
- Expose counts in metrics and reports.
**Acceptance criteria.**
- [ ] Teach shows gate.attempts>0; reports include gating panel.
**Files/paths.** hippo_mem/gating/*.py, reports/templates/partials/gating.md.j2, tests/test_gating.py

## T08. Retrieval telemetry & NoRetrieval badge

**Rationale.** We need proof that retrieval is exercised.

**Implementation steps.**
- Log retrieval.requests/k/hits@k per suite.
- If zero, show 'NoRetrieval' badge and fail preflight for memory-marked suites.
**Acceptance criteria.**
- [ ] Non-zero retrieval on memory suites; badge appears when missing.
**Files/paths.** hippo_mem/retrieval/*.py, reports/plots/retrieval.py, reports/templates/partials/retrieval.md.j2

## T09. Auto-prune non-informative parameter sweeps

**Rationale.** Flat sweeps should be hidden and discouraged.

**Implementation steps.**
- Compute Δ vs baseline; if < ε, tag sweep as Non-informative and hide by default.
**Acceptance criteria.**
- [ ] Reports mark/prune flat sweeps; CI skips them.
**Files/paths.** scripts/sweeps.py, reports/templates/partials/sweeps.md.j2

## T10. Docs: dataset profiles & run contract

**Rationale.** Reduce operator error and clarify expectations.

**Implementation steps.**
- Add 'Meaningful Run Contract' checklist to EVAL_PROTOCOL.md.
- Document profiles ('default','hard') and expected deltas.
**Acceptance criteria.**
- [ ] Docs include checklist and profiles; referenced by EVAL_PLAN.md.
**Files/paths.** /mnt/data/hippo-llm-memory-main/EVAL_PROTOCOL.md, /mnt/data/hippo-llm-memory-main/EVAL_PLAN.md

## T11. CI smoke tests + ablation gates

**Rationale.** Prevent regressions between rounds.

**Implementation steps.**
- Add GH Actions workflow to run minimal fixtures with memory vs ablated memory; fail if Δ below threshold.
**Acceptance criteria.**
- [ ] CI fails when memory dependency is not observed on fixtures.
**Files/paths.** .github/workflows/ci.yaml, tests/fixtures/*

## T12. Report health badges (surface failures first)

**Rationale.** Make failures impossible to miss in reports.

**Implementation steps.**
- Add badges: BaselinesOK, NonStubStores, GatingActive, RetrievalActive with links to artifacts.
**Acceptance criteria.**
- [ ] Reports display red/yellow/green health panel on top.
**Files/paths.** reports/templates/index.md.j2, reports/health.py
